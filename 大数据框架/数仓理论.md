&emsp;<a href="#0">数仓理论</a>  
&emsp;&emsp;<a href="#1">数据仓库发展三过程</a>  
&emsp;&emsp;<a href="#2">数据仓库的特点</a>  
&emsp;&emsp;<a href="#3">数据仓库分层</a>  
&emsp;&emsp;<a href="#4">OLAP、OLTP</a>  
&emsp;&emsp;<a href="#5">范式建模和维度建模</a>  
&emsp;&emsp;<a href="#6">星型、雪花、星座模型</a>  
&emsp;&emsp;<a href="#7">三种事实表</a>  
&emsp;&emsp;<a href="#8">事实表设计原则</a>  
&emsp;&emsp;<a href="#9">衡量数仓的数据质量指标</a>  
## <a name="0">数仓理论


### <a name="1">数据仓库发展三过程


```
简单报表阶段：解决日常工作中业务人员需要的报表，生产一些简单的能够帮助领导进行决策的汇总数据，基本表现为数据库和前端报表工具。

数据集市阶段：根据某个部门业务的需要，进行一定的数据采集、整理，能够为特定业务提供数据指导。

数据仓库阶段：根据一定的数据模型，对整个企业的数据进行采集、整理。根据各个业务部门的需要，提供跨部门的，完全一致的业务报表数据，为领导决策提供全面的数据支持
```

### <a name="2">数据仓库的特点


- 面向主题：数据按照一定的主题进行组织，每一个主题对应一个宏观的分析领域。
- 集成：企业内不同业务部门数据完整的集合。
- 稳定：不存在数据的更新和删除（删除是指历史数据超过存储期限）
- 数据随时间变化而变化：完整的记录某个对象在一段时期内的变化情况

### <a name="3">数据仓库分层


1. 隔离原始数据：不论是数据的异常还是数据敏感度，使真实数据与统计数据解耦开
2. 数据结构化清晰：每一个数据分层都有它的作用域和职责，使用表的时候能更方便地定位和理解
3. 数据血缘追踪：提供给外界的一张业务表来源于很多表，快速定位问题
4. 增强数据复用能力：减少重复开发，通过数据分层规范化，开发一些通用地中间层数据，提高单张业务表地使用率
5. 简化复杂问题：把一个复杂地问题分成多个步骤实现，每一层只处理单一的步骤
6. 减少业务的影响：业务可能会经常变化，不必改变一次业务就需要重新接入数据
7. 统一数据口径：通过数据分层，提高统一的数据出口

![](https://yingziimage.oss-cn-beijing.aliyuncs.com/img/202302151536432.png)

ODS——原始数据层：存放原始数据

```
数据源中的数据经过ETL（抽取、洗净、传输）后装入本层；
ODS层的表通常包括两类：用于存储当前需要加载的数据、用于存储处理完后的历史数据
```

DWD——数据明细层：对ODS层数据进行清洗、维度退化、脱敏等，覆盖所有系统的、完整的具有一致性的数据层

```
对ODS层数据进行加工处理，提供更干净的数据；
同时为了提高数据明细层的易用性采用一些维度退化手法，当一个维度数据不被数据仓库所需要，就将其退化维度至事实表
```

DWS——数据服务层：对DWD层数据进行一个轻度的汇总

```
DWS层为公共汇总层，进行轻度汇总，粒度比明细数据层粗；
该层数据表相对较少，大多都是宽表。用于提供后续的业务查询、OLAP分析、数据分发等
```

DM——数据集市层：为各种统计报表提供数据

```
数据应用层，针对具体的业务需求，生成特定字段比较多的宽表，提供后续的业务查询、OLAP分析、数据分发
```

ADS——应用数据层（数据应用层）：直接面向业务需求，提供报表、API 等定制化数据服务。


### <a name="4">OLAP、OLTP


OLAP（联机分析处理）：针对某些主题的历史数据进行分析、支持管理决策

OLTP（联机事物处理）：针对具体业务在数据库联机的日常操作，对少数记录的增删改查，对标传统的数据库系统

| OLAP（分析型）               | OLTP（操作型）               |
| ---------------------------- | ---------------------------- |
| 综合的、提炼的               | 细节的                       |
| 星型、雪花                   | 实体-关系（E-R）             |
| 存储历史数据，不包含最近数据 | 存取瞬间数据                 |
| 只读，只追加                 | 可更新                       |
| 性能要求宽松                 | 性能要求高，响应时间短       |
| 面向分析                     | 面向事务                     |
| 一次操作数据量大             | 一次操作数据量小             |
| 支持决策需求                 | 支持日操操作                 |
| 数据量大                     | 数据量小                     |
| 客户收益分析、市场细分       | 客户订单、客存水平和银行账户 |
| 一次操作一个集合             | 一个操作一个单元             |

### <a name="5">范式建模和维度建模


```
1、范式建模
Inmon提出的自上而下的数据仓库架构。通过ETL抽取转换和加载到数据仓库的ODS层，然后通过ODS的数据建设原子数据的数据仓库EDW，EDW不是多维格式，不方便上层应用做数据分析，需要通过汇总建设成多维格式的数据集市层
优：易于维护，高度集成
缺：结构死板，部署周期长

2、维度建模
Kimball提出的总线式的自下而上的数据仓库架构。利用维度建模方法建设一致维度的数据集市
优：构建迅速，最快能看到投资回报率，敏捷灵活
缺：作为企业资源不好维护，结构复杂，数据集市集成困难
```



### <a name="6">星型、雪花、星座模型


星型：所有维度表直接与事实表连接

<img src="https://yingziimage.oss-cn-beijing.aliyuncs.com/img/202211022008451.png" style="zoom:50%;" />

雪花：一个或多个维度表没有直接连接到事实表，而是通过其它维度表连接到事实表

<img src="https://yingziimage.oss-cn-beijing.aliyuncs.com/img/202211022008913.png" style="zoom:67%;" />

星座：事实表共有一些维度表

<img src="https://yingziimage.oss-cn-beijing.aliyuncs.com/img/202211022009215.png" style="zoom:67%;" />

```
星型模型
	优点：统计查询不需要做外部的连接，设计与实现比较简单，效率比雪花模型要高
	缺点；数据冗余

雪花模型：
	优点：减少数据冗余，最大限度的减少数量以及连接较小的维度表来实现改善查询的功能。
	缺点：事实表和维度表之间连接较多，查询性能相对较低
```

|                | 星型     | 雪花               |
| -------------- | -------- | ------------------ |
| 数据总量       | 多       | 少                 |
| 可读性         | 容易     | 差                 |
| 表个数         | 少       | 多                 |
| 查询速度       | 快       | 慢                 |
| 冗余度         | 高       | 低                 |
| 对实时表的情况 | 增加宽带 | 字段比较少，冗余低 |
| 扩展性         | 差       | 好                 |





### <a name="7">三种事实表


事实表作为数据仓库维度建模的核心，紧紧围绕着业务过程来设计，通过获取描述业务过程的度量来表达业务过程，包含了引用的维度和业务过程有关的度量。事务表有三种类型：事务事实表、周期快照事实表、累计快照事实表

- 事务事实表：原子事实表，描述业务过程，跟踪控件或时间上某点的度量时间，保存的是最原子数据
- 周期快照事实表：以一个周期为时间间隔记录事实，只看某个业务过程。
- 累计快照事实表：描述过程开始和结束之间的关键步骤时间，覆盖过程的整个生命周期，比如：创建订单->卖家付款->卖家发货->买家确认收货

|            | 事务事实表             | 周期快照事实表               | 累计快照事实表                   |
| ---------- | ---------------------- | ---------------------------- | -------------------------------- |
| 时间       | 离散事务时间点         | 有规律的、可预测的           | 时间跨度不确定的不断变化的工作流 |
| 日期维度   | 事务时期               | 快照日期                     | 相关业务过程涉及的多个日期       |
| 粒度       | 每行代表实体的一个事务 | 每行代表某时间周期的一个实体 | 每行代表一个实体的生命周期       |
| 事实       | 事务事实               | 累积事实                     | 相关业务过程事实和时间间隔事实   |
| 事实加载表 | 插入                   | 插入                         | 插入与更新                       |
| 事实更新表 | 不更新                 | 不更新                       | 业务过程变更时更新               |

### <a name="8">事实表设计原则


```
1、尽可能包含所有与业务过程相关的事实
2、只选择与业务过程相关的事实
3、分解不可加性事实为可加的组件
4、在选择维度和事实之前必须先声明粒度
5、在同一个事实表中不能有多种不同粒度的事实
6、事实的单位要保持一致
7、对事实的null值要处理
8、使用退化维度提高事实表的易用性
```

### <a name="9">衡量数仓的数据质量指标


数据质量的好坏是决定一个数据仓库的关键，从下列下面衡量系统中的数据质量

```
准确性：存储在系统中的一个数据元素的值是这个数据元素的正确值
域完整性：一个属性的数值在合理且预定义的范围之内
数据类型：数据属性的值通常根据这个属性所定义的数据类型来存储
一致性：一个数据字段的形式和内容在多个源系统之间是相同的
冗余性：相同的数据在一个系统中不能存储在多个地方
完整性：系统中的属性不应该有缺失的值
重复性：完全解决一个系统中记录的重复性的问题
结构明确：在数据项的结构可以分成不同部分的任何地方，这个数据项必须包含定义好的结构
数据异常：一个字段必须根据预先定义的目的来使用
清晰：一个数据元素必须有正确的定义
时效性：用户决定了数据的时效性
有用性：数据仓库中的每一个数据元素必须满足用户的一些需求
符合数据完整性规则：源系统中的关系数据库中存储的数据必须符合实体完整性及参考完整性规则
```



